<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æœã®æ”¯åº¦ã‚¢ãƒ—ãƒª ğŸŒŸ</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Hiragino Kaku Gothic ProN', sans-serif;
      min-height: 100vh;
      transition: background 0.5s ease;
    }
    body.theme-train { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    body.theme-sweets { background: linear-gradient(135deg, #FFB6D9 0%, #FFC8DD 50%, #FFE5EC 100%); }
    body.theme-animals { background: linear-gradient(135deg, #90EE90 0%, #98D8C8 50%, #87CEEB 100%); }
    .container { max-width: 800px; margin: 0 auto; padding: 20px; }
    .header { text-align: center; color: white; margin-bottom: 30px; }
    .header h1 { font-size: 2.5rem; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); margin-bottom: 10px; }
    .current-time { font-size: 2rem; font-weight: bold; text-shadow: 1px 1px 2px rgba(0,0,0,0.3); }
    .screen { display: none; }
    .screen.active { display: block; }
    .settings-btn {
      position: fixed;
      top: 20px;
      right: 20px;
      background: white;
      color: #667eea;
      border: 2px solid #667eea;
      padding: 10px 20px;
      border-radius: 50px;
      cursor: pointer;
      font-size: 1rem;
      box-shadow: 0 3px 10px rgba(0,0,0,0.2);
      z-index: 100;
    }
    .settings-btn:hover { background: #667eea; color: white; }
    
    /* ãƒ†ãƒ¼ãƒé¸æŠç”»é¢ */
    .theme-selection {
      background: white;
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      text-align: center;
    }
    .theme-selection h2 { color: #667eea; margin-bottom: 30px; font-size: 2rem; }
    .theme-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
    .theme-card {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 30px;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 3px solid transparent;
    }
    .theme-card:hover { transform: scale(1.05); box-shadow: 0 5px 20px rgba(0,0,0,0.2); }
    .theme-card.selected { border-color: #667eea; background: #e7eaf6; }
    .theme-card-icon { font-size: 4rem; margin-bottom: 15px; }
    .theme-card-name { font-size: 1.3rem; font-weight: bold; color: #333; }
    
    .journey-progress {
      background: white;
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    .journey-title { text-align: center; font-size: 1.5rem; font-weight: bold; margin-bottom: 15px; }
    .theme-train .journey-title { color: #667eea; }
    .theme-sweets .journey-title { color: #FF69B4; }
    .theme-animals .journey-title { color: #228B22; }
    .journey-info { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
    .current-location { font-size: 1.3rem; color: #333; }
    .location-emoji { font-size: 2rem; margin-right: 10px; }
    .journey-stats { text-align: right; color: #666; }
    .next-goal { background: #f8f9fa; padding: 15px; border-radius: 10px; text-align: center; font-weight: bold; }
    .theme-train .next-goal { color: #667eea; }
    .theme-sweets .next-goal { color: #FF69B4; }
    .theme-animals .next-goal { color: #228B22; }
    
    .train-progress {
      background: white;
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    .train-animation {
      position: relative;
      height: 80px;
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 10px;
    }
    .theme-train .train-animation { background: linear-gradient(to bottom, #87ceeb 0%, #87ceeb 50%, #90ee90 50%, #90ee90 100%); }
    .theme-sweets .train-animation { background: linear-gradient(to bottom, #FFE5EC 0%, #FFE5EC 50%, #FFF0F5 50%, #FFF0F5 100%); }
    .theme-animals .train-animation { background: linear-gradient(to bottom, #87CEEB 0%, #87CEEB 50%, #90EE90 50%, #90EE90 100%); }
    .train {
      position: absolute;
      bottom: 10px;
      left: 0%;
      font-size: 3rem;
      transition: left 0.8s ease-out;
    }
    .theme-train .train { transform: scaleX(-1); }
    .station-goal { position: absolute; right: 20px; bottom: 10px; font-size: 2.5rem; }
    .progress-text { text-align: center; font-size: 1.2rem; font-weight: bold; margin-top: 10px; }
    .theme-train .progress-text { color: #667eea; }
    .theme-sweets .progress-text { color: #FF69B4; }
    .theme-animals .progress-text { color: #228B22; }
    
    .stations-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; }
    .station-card {
      background: white;
      border-radius: 15px;
      padding: 25px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 3px solid #e0e0e0;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
      position: relative;
    }
    .station-card:hover:not(.completed) { transform: scale(1.05); box-shadow: 0 5px 20px rgba(0,0,0,0.3); }
    .theme-train .station-card:hover:not(.completed) { border-color: #667eea; }
    .theme-sweets .station-card:hover:not(.completed) { border-color: #FF69B4; }
    .theme-animals .station-card:hover:not(.completed) { border-color: #228B22; }
    .theme-train .station-card.completed { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    .theme-sweets .station-card.completed { background: linear-gradient(135deg, #FFB6D9 0%, #FFC8DD 100%); }
    .theme-animals .station-card.completed { background: linear-gradient(135deg, #90EE90 0%, #98D8C8 100%); }
    .station-card.completed { color: white; border-color: #ffd700; cursor: default; }
    .station-number { font-size: 0.9rem; opacity: 0.7; margin-bottom: 10px; }
    .station-name { font-size: 1.4rem; font-weight: bold; margin-bottom: 15px; }
    .station-icon { font-size: 2.5rem; margin-bottom: 10px; }
    .stamp { position: absolute; top: 10px; right: 10px; font-size: 2rem; animation: stampAppear 0.5s ease-out; }
    
    .completion-screen { text-align: center; color: white; }
    .completion-message {
      background: white;
      border-radius: 20px;
      padding: 50px;
      margin-bottom: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      animation: bounceIn 1s ease-out;
    }
    .completion-message h2 { font-size: 2.5rem; margin-bottom: 20px; }
    .theme-train .completion-message h2 { color: #667eea; }
    .theme-sweets .completion-message h2 { color: #FF69B4; }
    .theme-animals .completion-message h2 { color: #228B22; }
    .train-type-result { font-size: 4rem; margin: 30px 0; animation: pulse 2s infinite; }
    .completion-text { font-size: 1.5rem; color: #666; line-height: 1.8; }
    .departure-animation { font-size: 5rem; display: inline-block; }
    .theme-train .departure-animation { animation: trainDepart 3s ease-in-out; transform: scaleX(-1); }
    .theme-sweets .departure-animation { animation: sweetFloat 3s ease-in-out; }
    .theme-animals .departure-animation { animation: animalJump 3s ease-in-out; }
    
    .btn {
      color: white;
      border: none;
      padding: 15px 40px;
      font-size: 1.2rem;
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 5px 15px rgba(0,0,0,0.4);
      margin: 10px;
    }
    .theme-train .btn { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    .theme-sweets .btn { background: linear-gradient(135deg, #FF69B4 0%, #FF1493 100%); }
    .theme-animals .btn { background: linear-gradient(135deg, #228B22 0%, #006400 100%); }
    .btn:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(0,0,0,0.6); }
    .btn-secondary { background: linear-gradient(135deg, #90ee90 0%, #32cd32 100%) !important; }
    .button-group { text-align: center; margin-top: 20px; }
    
    .completion-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0);
      background: white;
      padding: 40px 60px;
      border-radius: 20px;
      box-shadow: 0 10px 50px rgba(0,0,0,0.3);
      z-index: 1000;
      text-align: center;
      animation: popupAppear 0.5s ease-out forwards;
    }
    .completion-popup-message { font-size: 2.5rem; font-weight: bold; margin-bottom: 20px; }
    .theme-train .completion-popup-message { color: #667eea; }
    .theme-sweets .completion-popup-message { color: #FF69B4; }
    .theme-animals .completion-popup-message { color: #228B22; }
    .completion-popup-emoji { font-size: 4rem; animation: bounce 0.6s ease-in-out; }
    .popup-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 999; display: none; }
    .popup-overlay.active { display: block; }
    
    .settings-panel {
      background: white;
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 20px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    .settings-panel h3 { color: #667eea; margin-bottom: 20px; }
    .task-list { margin-bottom: 20px; }
    .task-item {
      background: #f8f9fa;
      padding: 15px;
      margin-bottom: 10px;
      border-radius: 10px;
      display: flex;
      gap: 10px;
      align-items: center;
    }
    .task-item input { flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 5px; }
    .task-item button { padding: 8px 15px; background: #ff6b6b; color: white; border: none; border-radius: 5px; cursor: pointer; }
    .add-task-btn { background: #667eea; color: white; padding: 10px 20px; border: none; border-radius: 50px; cursor: pointer; margin-top: 10px; }
    
    @keyframes stampAppear { 0% { transform: scale(0) rotate(0deg); opacity: 0; } 50% { transform: scale(1.5) rotate(180deg); } 100% { transform: scale(1) rotate(360deg); opacity: 1; } }
    @keyframes bounceIn { 0% { transform: scale(0.3); opacity: 0; } 50% { transform: scale(1.05); } 100% { transform: scale(1); opacity: 1; } }
    @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
    @keyframes trainDepart { 0% { transform: scaleX(-1) translateX(0); } 70% { transform: scaleX(-1) translateX(0); } 100% { transform: scaleX(-1) translateX(200vw); } }
    @keyframes sweetFloat { 0% { transform: translateY(0); } 70% { transform: translateY(0); } 100% { transform: translateY(-200vh); } }
    @keyframes animalJump { 0% { transform: translateY(0); } 70% { transform: translateY(0); } 85% { transform: translateY(-100px); } 100% { transform: translateY(-200vh); } }
    @keyframes confettiFall { to { transform: translateY(100vh) rotate(360deg); opacity: 0; } }
    @keyframes popupAppear { 0% { transform: translate(-50%, -50%) scale(0); opacity: 0; } 50% { transform: translate(-50%, -50%) scale(1.1); } 100% { transform: translate(-50%, -50%) scale(1); opacity: 1; } }
    @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }
    @media (max-width: 600px) { .header h1 { font-size: 2rem; } .station-name { font-size: 1.2rem; } .stations-grid { grid-template-columns: 1fr; } }
  </style>
</head>
<body class="theme-train">
  <button class="settings-btn" onclick="showSettings()">âš™ï¸ è¨­å®š</button>
  
  <div class="container">
    <div class="header">
      <h1 id="appTitle">ğŸš‚ æœã®æ”¯åº¦ã‚¨ã‚¯ã‚¹ãƒ—ãƒ¬ã‚¹ ğŸš‚</h1>
      <div class="current-time" id="currentTime"></div>
    </div>

    <!-- ãƒ†ãƒ¼ãƒé¸æŠç”»é¢ -->
    <div id="themeScreen" class="screen">
      <div class="theme-selection">
        <h2>ãƒ†ãƒ¼ãƒã‚’é¸ã‚“ã§ã­ï¼</h2>
        <div class="theme-cards">
          <div class="theme-card" onclick="selectTheme('train')">
            <div class="theme-card-icon">ğŸš‚</div>
            <div class="theme-card-name">ã§ã‚“ã—ã‚ƒ</div>
          </div>
          <div class="theme-card" onclick="selectTheme('sweets')">
            <div class="theme-card-icon">ğŸ°</div>
            <div class="theme-card-name">ãŠã‹ã—ã‚„ã•ã‚“</div>
          </div>
          <div class="theme-card" onclick="selectTheme('animals')">
            <div class="theme-card-icon">ğŸ¦</div>
            <div class="theme-card-name">ã©ã†ã¶ã¤ãˆã‚“</div>
          </div>
        </div>
        <button class="btn" onclick="confirmTheme()">ãã‚ãŸï¼</button>
      </div>
    </div>

    <!-- è¨­å®šç”»é¢ -->
    <div id="settingsScreen" class="screen">
      <div class="settings-panel">
        <h3>âš™ï¸ è¨­å®š</h3>
        <div style="margin-bottom: 20px;">
          <label style="display: block; margin-bottom: 10px; font-weight: bold;">ãƒ†ãƒ¼ãƒå¤‰æ›´:</label>
          <select id="themeSelect" onchange="changeTheme(this.value)" style="padding: 10px; border-radius: 5px; width: 100%;">
            <option value="train">ğŸš‚ ã§ã‚“ã—ã‚ƒ</option>
            <option value="sweets">ğŸ° ãŠã‹ã—ã‚„ã•ã‚“</option>
            <option value="animals">ğŸ¦ ã©ã†ã¶ã¤ãˆã‚“</option>
          </select>
        </div>
        <h4 style="margin: 20px 0 10px 0;">ã‚¿ã‚¹ã‚¯è¨­å®š:</h4>
        <div class="task-list" id="taskList"></div>
        <button class="add-task-btn" onclick="addTask()">â• ã‚¿ã‚¹ã‚¯è¿½åŠ </button>
        <div style="margin-top: 30px; padding: 20px; background: #fff3cd; border-radius: 10px; border: 2px solid #ffc107;">
          <h4 style="color: #856404; margin-bottom: 10px;">âš ï¸ ãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆ</h4>
          <p style="color: #856404; margin-bottom: 15px; font-size: 0.9rem;">é–“é•ãˆã¦å®Œäº†ã—ã¦ã—ã¾ã£ãŸæ™‚ãªã©ã«ä½¿ãˆã¾ã™</p>
          <button onclick="resetJourneyCount()" style="background: #ffc107; color: #000; padding: 10px 20px; border: none; border-radius: 50px; cursor: pointer; margin-right: 10px;">ğŸ”„ ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³é€²æ—ãƒªã‚»ãƒƒãƒˆ</button>
          <button onclick="resetAllData()" style="background: #dc3545; color: white; padding: 10px 20px; border: none; border-radius: 50px; cursor: pointer;">ğŸ—‘ï¸ å…¨ãƒ‡ãƒ¼ã‚¿å‰Šé™¤</button>
        </div>
        <div class="button-group">
          <button class="btn" onclick="saveSettings()">ä¿å­˜ã—ã¦æˆ»ã‚‹</button>
        </div>
      </div>
    </div>

    <!-- ãƒ¡ã‚¤ãƒ³ç”»é¢ -->
    <div id="stationScreen" class="screen">
      <div class="journey-progress">
        <div class="journey-title" id="journeyTitle">ğŸ—¾ æ—¥æœ¬ä¸€å‘¨ã®æ—… ğŸ—¾</div>
        <div class="journey-info">
          <div class="current-location"><span class="location-emoji" id="locationEmoji">â„ï¸</span><span id="currentLocation">æœ­å¹Œ</span></div>
          <div class="journey-stats"><div id="journeyCount">0å›å®Œäº†</div></div>
        </div>
        <div class="next-goal" id="nextGoal">æ¬¡ã¯é’æ£®ã¸ï¼(ã‚ã¨3å›)</div>
      </div>
      <div class="train-progress">
        <div class="train-animation"><div class="train" id="trainIcon">ğŸšƒ</div><div class="station-goal" id="stationGoal">ğŸ</div></div>
        <div class="progress-text" id="progressText"></div>
      </div>
      <div class="stations-grid" id="stationsGrid"></div>
      <div class="button-group"><button class="btn btn-secondary" onclick="showRecords()">ä»Šé€±ã®è¨˜éŒ²ã‚’è¦‹ã‚‹</button></div>
    </div>

    <!-- å®Œäº†ç”»é¢ -->
    <div id="completionScreen" class="screen">
      <div class="completion-message">
        <h2 id="completionTitle">ğŸ‰ å…¨é§…ã‚¯ãƒªã‚¢! ğŸ‰</h2>
        <div class="train-type-result" id="trainTypeResult"></div>
        <div class="completion-text" id="completionText"></div>
        <div id="journeyUpdate"></div>
      </div>
      <div class="departure-animation" id="departureAnimation">ğŸšƒ</div>
      <div class="button-group">
        <button class="btn" onclick="resetToday()">ã‚‚ã†ä¸€åº¦ã‚„ã‚‹</button>
        <button class="btn btn-secondary" onclick="showRecords()">ä»Šé€±ã®è¨˜éŒ²ã‚’è¦‹ã‚‹</button>
      </div>
    </div>

    <!-- è¨˜éŒ²ç”»é¢ -->
    <div id="recordsScreen" class="screen">
      <div class="settings-panel">
        <h2 style="text-align: center; color: #667eea; font-size: 1.8rem; margin-bottom: 30px;">ğŸ“Š ä»Šé€±ã®è¨˜éŒ²</h2>
        <div id="recordsList"></div>
        <div class="button-group"><button class="btn" onclick="backToMain()">ã‚‚ã©ã‚‹</button></div>
      </div>
    </div>
  </div>

  <div class="popup-overlay" id="popupOverlay"></div>
  <div class="completion-popup" id="completionPopup" style="display: none;">
    <div class="completion-popup-emoji">ğŸ‰</div>
    <div class="completion-popup-message" id="popupMessage"></div>
  </div>

  <script>
    const THEMES = {
      train: {
        title: 'ğŸš‚ æœã®æ”¯åº¦ã‚¨ã‚¯ã‚¹ãƒ—ãƒ¬ã‚¹ ğŸš‚',
        journeyTitle: 'ğŸ—¾ æ—¥æœ¬ä¸€å‘¨ã®æ—… ğŸ—¾',
        icon: 'ğŸšƒ',
        goalIcon: 'ğŸ',
        stationIcon: 'ğŸ ',
        stationPrefix: 'é§…',
        collection: [
          { count: 0, name: 'æœ­å¹Œ', emoji: 'â„ï¸' },
          { count: 3, name: 'é’æ£®', emoji: 'ğŸ' },
          { count: 6, name: 'ä»™å°', emoji: 'ğŸŒ¾' },
          { count: 9, name: 'æ±äº¬', emoji: 'ğŸ—¼' },
          { count: 12, name: 'åå¤å±‹', emoji: 'ğŸ¯' },
          { count: 15, name: 'å¤§é˜ª', emoji: 'ğŸ™' },
          { count: 18, name: 'åºƒå³¶', emoji: 'â›©ï¸' },
          { count: 21, name: 'åšå¤š', emoji: 'ğŸœ' },
          { count: 24, name: 'é¹¿å…å³¶', emoji: 'ğŸŒ‹' },
          { count: 27, name: 'é‚£è¦‡', emoji: 'ğŸ–ï¸' },
          { count: 30, name: 'æ—¥æœ¬ä¸€å‘¨é”æˆï¼', emoji: 'ğŸŠ' }
        ],
        types: [
          { name: 'ç‰¹æ€¥', icon: 'ğŸš„', message: 'ã™ã”ã„! ç‰¹æ€¥é›»è»Šä¸¦ã¿ã®é€Ÿã•ã !', threshold: 10 },
          { name: 'æ€¥è¡Œ', icon: 'ğŸšƒ', message: 'ã‚„ã£ãŸã­! æ€¥è¡Œé›»è»Šã§å¿«é©ã«!', threshold: 20 },
          { name: 'å„é§…åœè»Š', icon: 'ğŸš‚', message: 'ã‚ˆããŒã‚“ã°ã£ãŸ! ã‚†ã£ãã‚Šç¢ºå®Ÿã«é€²ã‚“ã ã­!', threshold: 999 }
        ],
        completionTitle: 'ğŸ‰ å…¨é§…ã‚¯ãƒªã‚¢! ğŸ‰'
      },
      sweets: {
        title: 'ğŸ° æœã®æ”¯åº¦ ãŠã‹ã—ã‚„ã•ã‚“ ğŸ°',
        journeyTitle: 'ğŸª ãŠè“å­ãšã‹ã‚“ ğŸª',
        icon: 'ğŸ§',
        goalIcon: 'ğŸ‚',
        stationIcon: 'ğŸ¥š',
        stationPrefix: 'ã–ã„ã‚Šã‚‡ã†',
        collection: [
          { count: 0, name: 'ã‚¯ãƒƒã‚­ãƒ¼', emoji: 'ğŸª' },
          { count: 3, name: 'ã‚«ãƒƒãƒ—ã‚±ãƒ¼ã‚­', emoji: 'ğŸ§' },
          { count: 6, name: 'ãƒ‰ãƒ¼ãƒŠãƒ„', emoji: 'ğŸ©' },
          { count: 9, name: 'ã‚·ãƒ§ãƒ¼ãƒˆã‚±ãƒ¼ã‚­', emoji: 'ğŸ°' },
          { count: 12, name: 'ãƒã‚«ãƒ­ãƒ³', emoji: 'ğŸ®' },
          { count: 15, name: 'ãƒ‘ãƒ•ã‚§', emoji: 'ğŸ¨' },
          { count: 18, name: 'ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆ', emoji: 'ğŸ«' },
          { count: 21, name: 'ã‚­ãƒ£ãƒ³ãƒ‡ã‚£', emoji: 'ğŸ¬' },
          { count: 24, name: 'ãƒ­ãƒ¼ãƒ«ã‚±ãƒ¼ã‚­', emoji: 'ğŸ‚' },
          { count: 27, name: 'ã‚¢ã‚¤ã‚¹ã‚¯ãƒªãƒ¼ãƒ ', emoji: 'ğŸ¦' },
          { count: 30, name: 'ãŠè“å­ãƒã‚¹ã‚¿ãƒ¼ï¼', emoji: 'ğŸ‘‘' }
        ],
        types: [
          { name: 'ç‰¹è£½ã‚¹ãƒšã‚·ãƒ£ãƒ«', icon: 'ğŸ‚', message: 'ã™ã”ã„ï¼ã¨ãã›ã„ã‚¹ãƒšã‚·ãƒ£ãƒ«ã ã‚ˆï¼', threshold: 10 },
          { name: 'ãƒ‡ãƒ©ãƒƒã‚¯ã‚¹', icon: 'ğŸ°', message: 'ã‚„ã£ãŸã­ï¼ãƒ‡ãƒ©ãƒƒã‚¯ã‚¹ã ã‚ˆï¼', threshold: 20 },
          { name: 'ãƒ›ãƒ¼ãƒ ãƒ¡ã‚¤ãƒ‰', icon: 'ğŸ§', message: 'ãŒã‚“ã°ã£ãŸã­ï¼ãŠã„ã—ãã§ããŸã‚ˆï¼', threshold: 999 }
        ],
        completionTitle: 'ğŸ‰ ãœã‚“ã¶ã§ããŸ! ğŸ‰'
      },
      animals: {
        title: 'ğŸ¦ æœã®æ”¯åº¦ ã©ã†ã¶ã¤ãˆã‚“ ğŸ¦',
        journeyTitle: 'ğŸ¾ ã©ã†ã¶ã¤ã‚«ãƒ¼ãƒ‰ ğŸ¾',
        icon: 'ğŸ¾',
        goalIcon: 'ğŸ ',
        stationIcon: 'ğŸ¾',
        stationPrefix: 'ã‚¨ãƒªã‚¢',
        collection: [
          { count: 0, name: 'ã‚¦ã‚µã‚®', emoji: 'ğŸ°' },
          { count: 3, name: 'ãƒ‘ãƒ³ãƒ€', emoji: 'ğŸ¼' },
          { count: 6, name: 'ãƒ©ã‚¤ã‚ªãƒ³', emoji: 'ğŸ¦' },
          { count: 9, name: 'ã‚¾ã‚¦', emoji: 'ğŸ˜' },
          { count: 12, name: 'ã‚­ãƒªãƒ³', emoji: 'ğŸ¦’' },
          { count: 15, name: 'ã‚³ã‚¢ãƒ©', emoji: 'ğŸ¨' },
          { count: 18, name: 'ãƒšãƒ³ã‚®ãƒ³', emoji: 'ğŸ§' },
          { count: 21, name: 'ãƒˆãƒ©', emoji: 'ğŸ¯' },
          { count: 24, name: 'ã‚·ãƒã‚¦ãƒ', emoji: 'ğŸ¦“' },
          { count: 27, name: 'ã‚µãƒ«', emoji: 'ğŸµ' },
          { count: 30, name: 'ã©ã†ã¶ã¤ã¯ã‹ã›ï¼', emoji: 'ğŸ“' }
        ],
        types: [
          { name: 'ãƒãƒ¼ã‚¿ãƒ¼ç´š', icon: 'ğŸ†', message: 'ã™ã”ã„ï¼ãƒãƒ¼ã‚¿ãƒ¼ã¿ãŸã„ã«ã¯ã‚„ã„ï¼', threshold: 10 },
          { name: 'ã‚¦ãƒç´š', icon: 'ğŸ´', message: 'ã‚„ã£ãŸã­ï¼ã‚¦ãƒã•ã‚“ã¿ãŸã„ã ã‚ˆï¼', threshold: 20 },
          { name: 'ã‚¾ã‚¦ã•ã‚“ç´š', icon: 'ğŸ˜', message: 'ãŒã‚“ã°ã£ãŸã­ï¼ã‚¾ã‚¦ã•ã‚“ã¿ãŸã„ã«ã‚†ã£ãã‚Šï¼', threshold: 999 }
        ],
        completionTitle: 'ğŸ‰ ãœã‚“ã¶ã§ããŸ! ğŸ‰'
      }
    };

    const DEFAULT_TASKS = {
      train: [
        { no: 1, name: 'ãŠãã‚‹é§…', message: 'å§‹ç™ºé§…ã«åˆ°ç€ï¼å‡ºç™ºé€²è¡Œï¼' },
        { no: 2, name: 'ã‚ã•ã”ã¯ã‚“é§…', message: 'ç‡ƒæ–™è£œçµ¦å®Œäº†ï¼å…ƒæ°—ã„ã£ã±ã„ï¼' },
        { no: 3, name: 'ããŒãˆã‚‹é§…', message: 'è»Šä¸¡ç‚¹æ¤œOKï¼æº–å‚™ä¸‡ç«¯ï¼' },
        { no: 4, name: 'ãƒˆã‚¤ãƒ¬é§…', message: 'è»Šå†…ãƒˆã‚¤ãƒ¬å®Œäº†ï¼ã‚¹ãƒƒã‚­ãƒªï¼' },
        { no: 5, name: 'ã’ã‚“ã‹ã‚“ã«GOé§…', message: 'å‡ºç™ºæº–å‚™å®Œäº†ï¼è¡Œã£ã¦ãã¾ã™ï¼' }
      ],
      sweets: [
        { no: 1, name: 'ãŠãã‚‹', message: 'ãŠã¯ã‚ˆã†ï¼ãŠåº—ã‚ªãƒ¼ãƒ—ãƒ³ã ã‚ˆï¼' },
        { no: 2, name: 'ã‚ã•ã”ã¯ã‚“', message: 'ãŠã„ã—ãé£Ÿã¹ãŸã­ï¼ã‚¨ãƒãƒ«ã‚®ãƒ¼æº€ã‚¿ãƒ³ï¼' },
        { no: 3, name: 'ããŒãˆã‚‹', message: 'ã‹ã‚ã„ã„ã‚¨ãƒ—ãƒ­ãƒ³ã ã­ï¼' },
        { no: 4, name: 'ãƒˆã‚¤ãƒ¬', message: 'ã™ã£ãã‚Šï¼ãŠè“å­ä½œã‚ŠãŒã‚“ã°ã‚ã†ï¼' },
        { no: 5, name: 'ã’ã‚“ã‹ã‚“ã«GO', message: 'ãŠè“å­å®Œæˆï¼ã•ã‚ã€ãŠå±Šã‘ã ã‚ˆï¼' }
      ],
      animals: [
        { no: 1, name: 'ãŠãã‚‹', message: 'ãŠã¯ã‚ˆã†ï¼å‹•ç‰©åœ’ã‚ªãƒ¼ãƒ—ãƒ³ã ã‚ˆï¼' },
        { no: 2, name: 'ã‚ã•ã”ã¯ã‚“', message: 'ã‚‚ãã‚‚ãï¼å‹•ç‰©ã•ã‚“ã¿ãŸã„ã«å…ƒæ°—ï¼' },
        { no: 3, name: 'ããŒãˆã‚‹', message: 'ã‹ã£ã“ã„ã„é£¼è‚²å“¡ã•ã‚“ã ã­ï¼' },
        { no: 4, name: 'ãƒˆã‚¤ãƒ¬', message: 'ã™ã£ãã‚Šï¼å‹•ç‰©ã•ã‚“ã®ãŠä¸–è©±ãŒã‚“ã°ã‚ã†ï¼' },
        { no: 5, name: 'ã’ã‚“ã‹ã‚“ã«GO', message: 'ã„ã£ã¦ã‚‰ã£ã—ã‚ƒã„ï¼å†’é™ºã®å§‹ã¾ã‚Šã ï¼' }
      ]
    };

    let currentData = { theme: 'train', tasks: [], records: [], journeyCount: 0 };
    let todayRecord = null;
    let selectedTheme = 'train';

    function initApp() {
      loadData();
      if (!currentData.theme || !currentData.tasks || currentData.tasks.length === 0) {
        // ãƒ‡ãƒ¼ã‚¿ãŒãªã„ã€ã¾ãŸã¯ã‚¿ã‚¹ã‚¯ãŒç©ºã®å ´åˆã¯ãƒ†ãƒ¼ãƒé¸æŠç”»é¢ã¸
        showThemeSelection();
      } else {
        selectedTheme = currentData.theme;
        applyTheme(selectedTheme);
        updateCurrentTime();
        setInterval(updateCurrentTime, 1000);
        checkTodayRecord();
      }
    }

    function showThemeSelection() {
      hideAllScreens();
      document.getElementById('themeScreen').classList.add('active');
    }

    function selectTheme(theme) {
      selectedTheme = theme;
      document.querySelectorAll('.theme-card').forEach(card => card.classList.remove('selected'));
      event.target.closest('.theme-card').classList.add('selected');
    }

    function confirmTheme() {
      if (!selectedTheme) {
        alert('ãƒ†ãƒ¼ãƒã‚’é¸ã‚“ã§ã­ï¼');
        return;
      }
      currentData.theme = selectedTheme;
      currentData.tasks = JSON.parse(JSON.stringify(DEFAULT_TASKS[selectedTheme]));
      currentData.records = [];
      currentData.journeyCount = 0;
      saveData();
      applyTheme(selectedTheme);
      updateCurrentTime();
      setInterval(updateCurrentTime, 1000);
      checkTodayRecord();
    }

    function applyTheme(theme) {
      document.body.className = 'theme-' + theme;
      const themeConfig = THEMES[theme];
      document.getElementById('appTitle').textContent = themeConfig.title;
      document.getElementById('journeyTitle').textContent = themeConfig.journeyTitle;
      document.getElementById('trainIcon').textContent = themeConfig.icon;
      document.getElementById('stationGoal').textContent = themeConfig.goalIcon;
      document.getElementById('completionTitle').textContent = themeConfig.completionTitle;
      document.getElementById('themeSelect').value = theme;
    }

    function changeTheme(theme) {
      if (confirm('ãƒ†ãƒ¼ãƒã‚’å¤‰æ›´ã—ã¾ã™ã‹ï¼Ÿ\nã‚¿ã‚¹ã‚¯ã¯ãã®ã¾ã¾æ®‹ã‚Šã¾ã™ã€‚')) {
        const oldTheme = currentData.theme;
        currentData.theme = theme;
        selectedTheme = theme;
        
        // ã‚¿ã‚¹ã‚¯ãŒç©ºã€ã¾ãŸã¯å‰ã®ãƒ†ãƒ¼ãƒã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¿ã‚¹ã‚¯ã¨åŒã˜å ´åˆã¯æ–°ã—ã„ãƒ†ãƒ¼ãƒã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«å¤‰æ›´
        if (!currentData.tasks || currentData.tasks.length === 0 || 
            JSON.stringify(currentData.tasks) === JSON.stringify(DEFAULT_TASKS[oldTheme])) {
          currentData.tasks = JSON.parse(JSON.stringify(DEFAULT_TASKS[theme]));
        }
        
        saveData();
        applyTheme(theme);
        updateJourneyDisplay();
        renderTaskList();
      }
    }

    function loadData() {
      const saved = localStorage.getItem('morningAppData');
      if (saved) {
        currentData = JSON.parse(saved);
        // tasksãŒç©ºã®å ´åˆã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¿ã‚¹ã‚¯ã‚’è¨­å®š
        if (!currentData.tasks || currentData.tasks.length === 0) {
          if (currentData.theme && DEFAULT_TASKS[currentData.theme]) {
            currentData.tasks = JSON.parse(JSON.stringify(DEFAULT_TASKS[currentData.theme]));
            saveData();
          }
        }
      }
    }

    function saveData() {
      localStorage.setItem('morningAppData', JSON.stringify(currentData));
    }

    function checkTodayRecord() {
      const today = new Date().toISOString().split('T')[0];
      todayRecord = currentData.records.find(r => r.date === today);
      
      if (!todayRecord) {
        todayRecord = {
          date: today,
          startTime: Date.now(),
          completed: false,
          completedTasks: [],
          type: null
        };
        currentData.records.push(todayRecord);
        saveData();
      }

      updateJourneyDisplay();
      
      if (todayRecord.completed) {
        showCompletionScreen(todayRecord.type);
      } else {
        showStationScreen();
      }
    }

    function updateCurrentTime() {
      document.getElementById('currentTime').textContent = new Date().toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' });
    }

    function updateJourneyDisplay() {
      const collection = THEMES[selectedTheme].collection;
      let currentItem = collection[0];
      for (let i = collection.length - 1; i >= 0; i--) {
        if (currentData.journeyCount >= collection[i].count) {
          currentItem = collection[i];
          break;
        }
      }

      let nextItem = null;
      for (let i = 0; i < collection.length; i++) {
        if (collection[i].count > currentData.journeyCount) {
          nextItem = collection[i];
          break;
        }
      }

      document.getElementById('locationEmoji').textContent = currentItem.emoji;
      document.getElementById('currentLocation').textContent = currentItem.name;
      document.getElementById('journeyCount').textContent = currentData.journeyCount + 'å›å®Œäº†';

      if (nextItem) {
        const remaining = nextItem.count - currentData.journeyCount;
        document.getElementById('nextGoal').textContent = `æ¬¡ã¯${nextItem.emoji}${nextItem.name}ï¼(ã‚ã¨${remaining}å›)`;
      } else {
        document.getElementById('nextGoal').textContent = currentItem.emoji + ' ' + currentItem.name;
      }
    }

    function showStationScreen() {
      hideAllScreens();
      document.getElementById('stationScreen').classList.add('active');
      
      const completedCount = todayRecord.completedTasks.length;
      const totalCount = currentData.tasks.length;
      
      const progress = totalCount > 0 ? (completedCount / totalCount) * 100 : 0;
      document.getElementById('trainIcon').style.left = progress + '%';
      document.getElementById('progressText').textContent = `ã‚ã¨ ${totalCount - completedCount} ã“!`;
      
      const stationsGrid = document.getElementById('stationsGrid');
      stationsGrid.innerHTML = '';
      
      const themeConfig = THEMES[selectedTheme];
      
      currentData.tasks.forEach(task => {
        const completed = todayRecord.completedTasks.includes(task.no);
        const stationCard = document.createElement('div');
        stationCard.className = 'station-card' + (completed ? ' completed' : '');
        if (!completed) {
          stationCard.onclick = () => completeStation(task.no, task.message);
        }
        
        stationCard.innerHTML = `
          <div class="station-number">${themeConfig.stationPrefix} ${task.no}</div>
          <div class="station-icon">${completed ? 'âœ…' : themeConfig.stationIcon}</div>
          <div class="station-name">${task.name}</div>
          ${completed ? '<div class="stamp">âœ¨</div>' : ''}
        `;
        
        stationsGrid.appendChild(stationCard);
      });
    }

    function completeStation(taskNo, message) {
      todayRecord.completedTasks.push(taskNo);
      saveData();
      
      showCompletionMessage(message);
      showStationScreen();
      createConfetti();
      
      if (todayRecord.completedTasks.length === currentData.tasks.length) {
        setTimeout(() => {
          const type = determineType();
          todayRecord.completed = true;
          todayRecord.type = type;
          todayRecord.endTime = Date.now();
          currentData.journeyCount++;
          saveData();
          showCompletionScreen(type);
        }, 2000);
      }
    }

    function determineType() {
      const minutes = (Date.now() - todayRecord.startTime) / 1000 / 60;
      const types = THEMES[selectedTheme].types;
      for (let type of types) {
        if (minutes <= type.threshold) {
          return type.name;
        }
      }
      return types[types.length - 1].name;
    }

    function showCompletionScreen(typeName) {
      hideAllScreens();
      document.getElementById('completionScreen').classList.add('active');
      
      const types = THEMES[selectedTheme].types;
      const type = types.find(t => t.name === typeName) || types[0];
      
      document.getElementById('trainTypeResult').textContent = type.icon + ' ' + type.name;
      document.getElementById('completionText').innerHTML = type.message + '<br><br>ã„ã£ã¦ã‚‰ã£ã—ã‚ƒã„! ğŸš€';
      
      updateJourneyDisplay();
      
      const collection = THEMES[selectedTheme].collection;
      let currentItem = collection[0];
      for (let i = collection.length - 1; i >= 0; i--) {
        if (currentData.journeyCount >= collection[i].count) {
          currentItem = collection[i];
          break;
        }
      }
      
      document.getElementById('journeyUpdate').innerHTML = `
        <div style="margin-top: 20px; padding: 20px; background: #f8f9fa; border-radius: 10px;">
          <div style="font-size: 1.3rem; margin-bottom: 10px;">${THEMES[selectedTheme].journeyTitle}</div>
          <div style="font-size: 1.1rem; color: #333;">ã¤ã†ã•ã‚“ ${currentData.journeyCount} å›å®Œäº†ï¼<br>ã„ã¾: ${currentItem.emoji} ${currentItem.name}</div>
        </div>
      `;
      
      document.getElementById('departureAnimation').textContent = type.icon;
      
      for (let i = 0; i < 50; i++) {
        setTimeout(() => createConfetti(), i * 50);
      }
    }

    function showRecords() {
      hideAllScreens();
      document.getElementById('recordsScreen').classList.add('active');
      
      const recordsList = document.getElementById('recordsList');
      recordsList.innerHTML = '';
      
      const weekAgo = new Date();
      weekAgo.setDate(weekAgo.getDate() - 7);
      
      const recentRecords = currentData.records
        .filter(r => new Date(r.date) >= weekAgo)
        .sort((a, b) => new Date(b.date) - new Date(a.date));
      
      if (recentRecords.length === 0) {
        recordsList.innerHTML = '<p style="text-align:center; color:#666; padding: 40px;">ã¾ã ãã‚ããŒã‚ã‚Šã¾ã›ã‚“</p>';
        return;
      }
      
      const types = THEMES[selectedTheme].types;
      
      recentRecords.forEach(record => {
        const recordItem = document.createElement('div');
        recordItem.className = 'task-item';
        recordItem.style.cursor = 'default';
        
        const date = new Date(record.date);
        const dateString = (date.getMonth() + 1) + '/' + date.getDate() + ' (' + ['æ—¥','æœˆ','ç«','æ°´','æœ¨','é‡‘','åœŸ'][date.getDay()] + ')';
        
        const type = types.find(t => t.name === record.type);
        const icon = type ? type.icon : 'ğŸ”„';
        const text = record.completed ? `âœ… ãœã‚“ã¶ã§ããŸ! ${icon} ${record.type}` : 'ğŸ”„ ã¡ã‚‡ã†ã›ã‚“ã¡ã‚…ã†...';
        
        recordItem.innerHTML = `
          <div style="flex: 1;">
            <div style="font-weight: bold; margin-bottom: 5px;">${dateString}</div>
            <div style="color: #666;">${text}</div>
          </div>
        `;
        
        recordsList.appendChild(recordItem);
      });
    }

    function showSettings() {
      hideAllScreens();
      document.getElementById('settingsScreen').classList.add('active');
      renderTaskList();
    }

    function renderTaskList() {
      const taskList = document.getElementById('taskList');
      taskList.innerHTML = '';
      
      currentData.tasks.forEach((task, index) => {
        const taskItem = document.createElement('div');
        taskItem.className = 'task-item';
        taskItem.innerHTML = `
          <input type="text" value="${task.name}" onchange="updateTaskName(${index}, this.value)" placeholder="ã‚¿ã‚¹ã‚¯å">
          <input type="text" value="${task.message}" onchange="updateTaskMessage(${index}, this.value)" placeholder="å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸">
          <button onclick="deleteTask(${index})">å‰Šé™¤</button>
        `;
        taskList.appendChild(taskItem);
      });
    }

    function updateTaskName(index, value) {
      currentData.tasks[index].name = value;
    }

    function updateTaskMessage(index, value) {
      currentData.tasks[index].message = value;
    }

    function addTask() {
      const newNo = currentData.tasks.length > 0 ? Math.max(...currentData.tasks.map(t => t.no)) + 1 : 1;
      currentData.tasks.push({
        no: newNo,
        name: 'æ–°ã—ã„ã‚¿ã‚¹ã‚¯',
        message: 'ã‚ˆãã§ãã¾ã—ãŸï¼'
      });
      renderTaskList();
    }

    function deleteTask(index) {
      if (confirm('ã“ã®ã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
        currentData.tasks.splice(index, 1);
        currentData.tasks.forEach((task, i) => {
          task.no = i + 1;
        });
        renderTaskList();
      }
    }

    function saveSettings() {
      saveData();
      alert('è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸï¼');
      applyTheme(currentData.theme);
      checkTodayRecord();
    }

    function resetToday() {
      if (confirm('ä»Šæ—¥ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
        const today = new Date().toISOString().split('T')[0];
        currentData.records = currentData.records.filter(r => r.date !== today);
        saveData();
        location.reload();
      }
    }

    function resetJourneyCount() {
      if (confirm('ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³é€²æ—ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ\nï¼ˆæ—¥æœ¬ä¸€å‘¨ãƒ»ãŠè“å­å›³é‘‘ãƒ»å‹•ç‰©ã‚«ãƒ¼ãƒ‰ãŒæœ€åˆã«æˆ»ã‚Šã¾ã™ï¼‰')) {
        currentData.journeyCount = 0;
        saveData();
        alert('ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³é€²æ—ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸï¼');
        updateJourneyDisplay();
      }
    }

    function resetAllData() {
      if (confirm('æœ¬å½“ã«å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\nã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ï¼\n\nå‰Šé™¤ã•ã‚Œã‚‹ã‚‚ã®:\nãƒ»ã‚¿ã‚¹ã‚¯è¨­å®š\nãƒ»ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³é€²æ—\nãƒ»å…¨ã¦ã®è¨˜éŒ²\n\nâ€»å‰Šé™¤å¾Œã€ãƒ†ãƒ¼ãƒé¸æŠã‹ã‚‰ã‚„ã‚Šç›´ã—ã¾ã™')) {
        if (confirm('æœ€çµ‚ç¢ºèªï¼šæœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
          localStorage.removeItem('morningAppData');
          location.reload();
        }
      }
    }

    function backToMain() {
      showStationScreen();
    }

    function hideAllScreens() {
      document.querySelectorAll('.screen').forEach(screen => {
        screen.classList.remove('active');
      });
    }

    function createConfetti() {
      const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#ffd93d', '#6c5ce7'];
      const confetti = document.createElement('div');
      confetti.style.position = 'fixed';
      confetti.style.width = '10px';
      confetti.style.height = '10px';
      confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
      confetti.style.left = Math.random() * 100 + '%';
      confetti.style.animation = 'confettiFall 3s ease-out forwards';
      document.body.appendChild(confetti);
      setTimeout(() => confetti.remove(), 3000);
    }

    function showCompletionMessage(message) {
      const popup = document.getElementById('completionPopup');
      const overlay = document.getElementById('popupOverlay');
      const messageEl = document.getElementById('popupMessage');
      
      messageEl.textContent = message;
      popup.style.display = 'block';
      overlay.classList.add('active');
      
      setTimeout(() => {
        popup.style.display = 'none';
        overlay.classList.remove('active');
      }, 1500);
    }

    window.onload = initApp;
  </script>
</body>
</html>
